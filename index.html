<!-- COMPLETE REPLACEMENT FILE -->

<!-- This file is your FULL index.html with image click ‚Üí big preview ‚Üí delete ‚Üí AI analyze -->

<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Landslide</title>

<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìç</text></svg>">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
body{margin:0;font-family:Inter;background:#222;overflow:hidden}
#map{position:fixed;top:60px;bottom:0;left:0;right:0}
.popup-img{width:60px;height:60px;object-fit:cover;border-radius:6px;border:1px solid #ccc;cursor:pointer}

/* IMAGE MODAL */
#imageModal{position:fixed;inset:0;display:none;z-index:300000}
.img-backdrop{position:absolute;inset:0;background:rgba(0,0,0,.85)}
.img-modal{position:absolute;inset:0;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:15px}
.img-modal img{max-width:95%;max-height:75vh;border-radius:12px;border:2px solid #fff;background:#000}
.img-actions{margin-top:12px;display:flex;gap:15px;background:rgba(0,0,0,.8);padding:10px 16px;border-radius:20px}
.img-actions a{color:#fff;font-weight:700;text-decoration:none;font-size:14px}
.img-delete{color:#ff5252}
.img-ai{color:#4caf50}
.img-close{color:#ccc}
</style>

</head>
<body>

<div id="map"></div>

<!-- IMAGE VIEWER MODAL -->

<div id="imageModal">
  <div class="img-backdrop" onclick="closeImageModal()"></div>
  <div class="img-modal">
    <img id="modalImage">
    <div class="img-actions">
      <a href="#" class="img-delete" onclick="deleteCurrentImage(event)">üóë Delete</a>
      <a href="#" class="img-ai" onclick="analyzeCurrentImage(event)">ü§ñ AI Analyze</a>
      <a href="#" class="img-close" onclick="closeImageModal()">‚úï Close</a>
    </div>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
// ============================
// BASIC MAP
// ============================
const map=L.map('map').setView([40.764356,-73.973057],18)
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map)

// ============================
// STAKES + PHOTOS
// ============================
let stakes=[]
let stakeMarkers={}

function addStake(lat,lng){
 const id=Date.now()
 const stake={id,lat,lng,photos:[]}
 stakes.push(stake)
 const m=L.marker([lat,lng]).addTo(map)
 stakeMarkers[id]=m
 updateStakePopup(stake)
}

map.on('click',e=>addStake(e.latlng.lat,e.latlng.lng))

function updateStakePopup(stake){
 let html='<div>'
 stake.photos.forEach(k=>{
  const src=localStorage.getItem(k)
  html+=`<img src="${src}" class="popup-img" onclick="openImageModal('${k}',${stake.id})">`
 })
 html+='<br><button onclick="addPhoto('+stake.id+')">üì∑ Add</button></div>'
 stakeMarkers[stake.id].bindPopup(html)
}

function addPhoto(stakeId){
 const input=document.createElement('input')
 input.type='file'
 input.accept='image/*'
 input.onchange=e=>{
  const file=e.target.files[0]
  const r=new FileReader()
  r.onload=ev=>{
   const key='img_'+Date.now()
   localStorage.setItem(key,ev.target.result)
   const s=stakes.find(x=>x.id===stakeId)
   s.photos.push(key)
   updateStakePopup(s)
  }
  r.readAsDataURL(file)
 }
 input.click()
}

// ============================
// IMAGE MODAL LOGIC
// ============================
let currentImageKey=null
let currentStakeId=null

function openImageModal(imgKey,stakeId){
 currentImageKey=imgKey
 currentStakeId=stakeId
 document.getElementById('modalImage').src=localStorage.getItem(imgKey)
 document.getElementById('imageModal').style.display='block'
}

function closeImageModal(){
 document.getElementById('imageModal').style.display='none'
 currentImageKey=null
 currentStakeId=null
}

function deleteCurrentImage(e){
 e.preventDefault()
 if(!confirm('Delete image?'))return
 const s=stakes.find(x=>x.id===currentStakeId)
 s.photos=s.photos.filter(p=>p!==currentImageKey)
 localStorage.removeItem(currentImageKey)
 updateStakePopup(s)
 closeImageModal()
}

function analyzeCurrentImage(e){
 e.preventDefault()
 alert('AI analysis placeholder\nImage size: '+Math.round(localStorage.getItem(currentImageKey).length/1024)+' KB')
}
</script>

</body>
</html>
